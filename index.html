<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OS</title>
</head>
<body oncontextmenu="return false">

<img id="star" width="200" height="220" src="assets/star.png" hidden>
<img id="login" width="200" height="220" src="assets/login.png" hidden>
<img id="settings" width="200" height="220" src="assets/settings.png" hidden>
<span id="landscapes" hidden>
    <img id="L1" width="200" height="220" src="assets/landscapes/1.jpeg" hidden>
    <img id="L2" width="200" height="220" src="assets/landscapes/2.jpeg" hidden>
    <img id="L3" width="200" height="220" src="assets/landscapes/3.jpg" hidden>
    <img id="L4" width="200" height="220" src="assets/landscapes/4.jpg" hidden>
    <img id="L5" width="200" height="220" src="assets/landscapes/5.webp" hidden>
    <img id="L6" width="200" height="220" src="assets/landscapes/6.jpeg" hidden>
</span>
<span id="games" hidden>
    <img id="Sudoku" width="200" height="220" src="assets/games/Sudoku/icon.png" hidden>
</span>
<canvas id="os" width="1450" height="789" tabindex='1'>
    Your browser does not support the HTML canvas tag.</canvas>
    <div id="List"></div>
    <div id="ImportantList"></div>

<script>
    var canvas = document.getElementById("os");
    var ctx = canvas.getContext("2d");
    var clickableElements = [];
    var lockscreen = {type:"picture", color: "5"};
    if (localStorage.lockscreen){
        lockscreen = JSON.parse(localStorage.lockscreen);
    };
    var language = "English";
    if (localStorage.language){
        language = localStorage.language;
    };
    var windows = [];
    ctx.font = "30px Arial";
    function createClick(x, y, width, height, clicked){
        clickableElements.push({x:x, y:y, width:width, height:height, code:clickableElements.length, functionOnClicked:clicked});
    };
    function LockScreen(){
        if (lockscreen.type == "color") {
            ctx.fillStyle = lockscreen.color;
            ctx.fillRect(0, 40, 1450, 789);
        }else if (lockscreen.type == "picture"){
            document.getElementById("L"+lockscreen.color).addEventListener("load", (e) => {
                ctx.drawImage(document.getElementById("L"+lockscreen.color), 0, 40, 1450, 710);
            });
        }
    };
    canvas.addEventListener('click', function(event) {
        const rect = canvas.getBoundingClientRect(); // Get canvas bounds
        const mouseX = event.clientX - rect.left; // Mouse X position relative to canvas
        const mouseY = event.clientY - rect.top; // Mouse Y position relative to canvas
        clickableElements.forEach((el) => {
        if (mouseX > el.x && mouseX < el.x + el.width && mouseY > el.y && mouseY < el.y + el.height) {
            el.functionOnClicked();
        }
        });
    });
    function createButton(x, y, width, height, title, fillColor="grey"){
        ctx.fillStyle = fillColor;
        ctx.fillRect(x, y, width, height);
        ctx.font = "20px Arial";
        ctx.fillStyle = "black";
        const textMetrics = ctx.measureText(title);
        const textWidth = textMetrics.width;
        ctx.fillText(title, x + (width - textWidth) / 2, y + (height + parseInt(ctx.font, 10)) / 2 - 5);
    };
    function createOnClickButton(x, y, width, height, title, onClick, fillColor="grey"){
        createButton(x, y, width, height, title, fillColor);
        createClick(x, y, width, height, onClick);
    };
    var inputNum = 0;
    var winNum = 0;
    function addInput(x, y, id=0) {

        var input = document.createElement('input');

        input.type = 'text';
        input.style.position = 'absolute';
        input.style.left = (x - 4) + 'px';
        input.style.top = (y - 4) + 'px';
        if (!id) {
            input.id = inputNum + "Id";
        }else {
            input.id = id;
        }
        inputNum++;

        input.onkeydown = handleEnter;

        document.getElementById((winNum==0?0:winNum-1)+"Div").appendChild(input);

        // input.focus();

        hasInput = true;
    }

    //Key handler for input box:
    function handleEnter(e) {
    var keyCode = e.keyCode;
    if (keyCode === 13) {
        drawText(this.value, parseInt(this.style.left, 10), parseInt(this.style.top, 10));
        document.body.removeChild(this);
        hasInput = false;
    }
    }

    //Draw the text onto canvas:
    function drawText(txt, x, y) {
    ctx.textBaseline = 'top';
    ctx.textAlign = 'left';
    ctx.font = font;
    ctx.fillText(txt, x - 4, y - 4);
    }
    function CreateDropDown(x, y){
        // Create Select
        select = document.createElement("select");
        select.style.position = 'absolute';
        select.style.left = (x - 4) + 'px';
        select.style.top = (y - 4) + 'px';
        select.id = inputNum+"Id";
        inputNum++;
        return select;
    };

    change = [inputNum];
    function CustomerDifficultyLogin(x, y, method){
        ctx.font = "15px Arial";
        ctx.fillText(language=='English'?"We're sorry to hear that! Please tell us about your problem.":"அதைக் கேட்டு வருந்துகிறோம்! உங்கள் பிரச்சனை பற்றி எங்களிடம் கூறுங்கள்.", x, y+350);
        change.push(inputNum);
        addInput(x+450, y+350, "CustomerDifficulty");
        if (method == "TVA") {
            createOnClickButton(x+1000, y+600, 300, 40, language=='English'?"Do The Google Forms":"படிவத்தை செய்யுங்கள்", (send)=>{
                window.open("https://docs.google.com/forms/d/e/1FAIpQLScEFQvepNagjLgymRZQuCPKik4Is-UTKoU3V9BAI-Nq8owfVw/viewform?usp=sharing");
            })
        }
        createOnClickButton(x, y+380, 100, 40, language=="English"?"Send":"அனுப்பு", (send)=>{
            send_to = "Vishnu Ramesh";
            if (method == "TVA"){
                send_to = "Joey Matteucci";
            };
            ctx.fillText("To "+send_to+",", x, y+500, 1450);
            ctx.fillText("  I have a problem with "+method+". My name is ____.", x, y+520, 1450);
            ctx.fillText("  My problem is that "+document.getElementById("CustomerDifficulty").value+".", x, y+540, 1450);
            ctx.fillText("  Please try to fix it! ", x, y+560, 1450);
            if (send_to == "Vishnu Ramesh") {
            ctx.fillText("  Email this to vishnuram9120@k12.ipsd.org", x, y+580, 1450);
            }else if (send_to == "Joey Matteucci") {
            ctx.fillText("  Email this to josephmat9428@k12.ipsd.org", x, y+580, 1450);
            }
            email_prompt = "To "+send_to+", \n  I have a problem with "+method+". My name is ____.\n  My problem is that "+document.getElementById("CustomerDifficulty").value+".\n  Please try to fix it! ";
            createOnClickButton(x, y+590, 100, 40, language=="English"?"Copy":"நகலாக்கு", (send)=>{
                navigator.clipboard.writeText(email_prompt);
            })
        });
    };

    function LoginApp(x, y, method){
        ctx.font = "20px Arial";
        ctx.fillText((language=="English"?"Please fill out the following form":"தயவுசெஞ்சு இந்த படிவத்தை நிரப்பவும்."), x, y+200);
        ctx.font = "15px Arial";
        ctx.fillText((language=="English"?"What is your purpose of coming here? ":"எதற்காக இங்கு வந்தாய்?."), x+20, y+300);
        select1 = CreateDropDown(x+300, y+300);
        select1.innerHTML = "<option value=1>"+(language=="English"?"Customer Difficulty":"வாடிக்கையாளர் கஷ்டம்")+"</option><option value=2>"+(language=="English"?"Enrollment":"சேரவும்")+"</option>";
        change = []
        CustomerDifficultyLogin(x, y, method)
        select1.addEventListener("change", (event)=>{
            document.getElementById((winNum==0?0:winNum-1) + "Div").innerHTML = "";
            document.getElementById((winNum==0?0:winNum-1) + "Div").appendChild(select1);
            // ctx.clearRect(x+1, y+310, 1449, 900);
            // ctx.clearRect(x+2, y+250, 500, 500);
            ctx.clearRect(x+2, y+100, 1450, 500);
            ctx.clearRect(x, y+380, 200, 300);
            ctx.clearRect(x+500, y+600, 500, 80);
            ctx.clearRect(x+1000, y+600, 300, 40);
            for (i=0;i<=clickableElements.length; i++){
                if (clickableElements[i]) {
                    // console.log(clickableElements[i], x, y+380, 100, 40);
                    if (clickableElements[i].x === x && clickableElements[i].y === y+380 && clickableElements[i].width===100 && clickableElements[i].height===40) {
                        console.log("Hi");
                        clickableElements.splice(i, 1);
                    }
                }
            };
            if (select1.value == 1){
                change.push(inputNum);
                CustomerDifficultyLogin(x, y, method)
            }else if (select1.value == 2){
                ctx.font = "15px Arial";
                ctx.fillText((language=="English"?"Tell me something good about you that could help us. Be short in your description.":"உங்களைப் பற்றி எங்களுக்கு உதவக்கூடிய நல்லதைச் சொல்லுங்கள்."), x+1, y+350);
                // change.add(inputNum);
                addInput(x+560, y+350, "GoodLogin");
                if (method == "TVA") {
                    createOnClickButton(x+500, y+630, 500, 40, language=='English'?"Do The Google Forms":"படிவத்தை செய்யுங்கள்", (send)=>{
                        window.open("https://docs.google.com/forms/d/e/1FAIpQLSeN8utjC2StrC0pMNWotB00ulUXHx_zHbBX4fhOhYuUTuIpnA/viewform?usp=sharing");
                    })
                }
                createOnClickButton(x, y+380, 100, 40, language=="English"?"Send":"அனுப்பு", (send)=>{
                    // document.getElementById("GoodLogin").value;
                    send_to = "Vishnu Ramesh";
                    if (method == "TVA"){
                        send_to = "Joey Matteucci";
                    };
                    ctx.fillText("To "+send_to+",", x, y+500, 1450);
                    ctx.fillText("  I want to enroll into "+method+". My name is ____.", x, y+520, 1450);
                    ctx.fillText("  One thing that is good about me is that I can "+document.getElementById("GoodLogin").value+".", x, y+540, 1450);
                    ctx.fillText("  Please respond with a location to meet! ", x, y+560, 1450);
                    if (send_to == "Vishnu Ramesh") {
                    ctx.fillText("  Email this to vishnuramesh620@gmail.com", x, y+580, 1450);
                    }else if (send_to == "Joey Matteucci") {
                    ctx.fillText("  Email this to josephmat9428@k12.ipsd.org", x, y+580, 1450);
                    }
                    // TODO: REDIRECT TO https://docs.google.com/forms/d/e/1FAIpQLSeN8utjC2StrC0pMNWotB00ulUXHx_zHbBX4fhOhYuUTuIpnA/viewform?usp=sharing INSTEAD
                    email_prompt = "To "+send_to+", \n  I want to enroll into "+method+". My name is ____.\n  One thing that is good about me is that I can "+document.getElementById("GoodLogin").value+"\n  Please respond with a location to meet! ";
                    createOnClickButton(x, y+590, 100, 40, language=="English"?"Copy":"நகலாக்கு", (send)=>{
                        navigator.clipboard.writeText(email_prompt);
                    })
                });
            }else if (select1.value == 3){
                ;
            };
        });
        document.getElementById((winNum==0?0:winNum-1) + "Div").appendChild(select1);
    };
    function LanguageChoose(x, y, alreadyWent=false){
        document.getElementById((winNum==0?0:winNum-1)+"Div").innerHTML = "";
                createOnClickButton(x+1, y+100, 300, 40, language=='English'?list[0][0]:list[0][1], (ev)=>{
                }, "gray");;
                createButton(x+1, y+150, 300, 40, language=='English'?list[2][0]:list[2][1], "gray");
                createButton(x+1, y+200, 300, 40, language=='English'?list[1][0]:list[1][1], "#b0b0b0");
                createButton(x+1, y+250, 300, 40, language=='English'?list[3][0]:list[3][1], "gray");
                ctx.clearRect(x+301, y+50, 900, 600);
                ctx.font = "25px Helvetica";
                ctx.fillText(language=='English'?list[1][0]:list[1][1]+": ", x+301, y+100);
                var dropDown = CreateDropDown(x+500, y+100);
                dropDown.innerHTML = "<option value=0>English</option><option value=1>தமிழ்</option>";
                // console.log(language);
                if (language == "English"){dropDown.children[0].setAttribute("selected", "true");}else if (language == "Tamil"){dropDown.children[1].setAttribute("selected", "true");};
                dropDown.addEventListener("change", (event)=>{
                    if (dropDown.value == 0){
                        language = "English";
                        localStorage.language = language;
                        if (alreadyWent == false) {
                        LanguageChoose(x, y, true);
                        }
                    }else if (dropDown.value == 1){
                        language = "Tamil";
                        localStorage.language = language;
                        if (alreadyWent == false) {
                        LanguageChoose(x, y, true);
                        }
                    };
                });
                document.getElementById((winNum==0?0:winNum-1)+"ImportantDiv").appendChild(dropDown);
    };

function getOSDetails() {
    const userAgent = navigator.userAgent;

    let os = "Unknown OS";

    if (userAgent.includes("Windows NT")) {
        os = "Windows";
    } else if (userAgent.includes("Macintosh")) {
        os = "Mac OS";
    } else if (userAgent.includes("Linux")) {
        os = "Linux";
    } else if (userAgent.includes("Android")) {
        os = "Android";
    } else if (userAgent.includes("iPhone")) {
        os = "iOS (iPhone)";
    } else if (userAgent.includes("iPad")) {
        os = "iOS (iPad)";
    } else if (userAgent.includes("CrOS")) {
        os = "Chrome OS (Chromebook)";
    }

    return os;
}


    function Setup(x, y, width, height, title, win){
        if (win.name == "RedGame"){
            ctx.font = "80px Roboto";
            ctx.fillText(language=="English"?"Games":"விளையாட்டு", x, y+100);
            ctx.font = "20px Arial";
            ctx.fillStyle = "gray";
            ctx.fillRect(x+20, y+120, 100, 100);
            ctx.drawImage(document.getElementById("Sudoku"), x+20, y+150, 100, 70);
            createClick(160, 743, 48, 48, ()=>{
                Game("RedGame");
            });
            createOnClickButton(x+20, y+120, 100, 40, "Sudoku", ()=>{
                ctx.clearRect(x-100, y+30, 700, 60);
                var iframe = document.createElement("iframe");
                iframe.src = "sudoku/index.html";
                iframe.style.position = 'absolute';
                iframe.style.left = (x+13 - 4) + 'px';
                iframe.style.top = (y+64 - 4) + 'px';
                iframe.id = (winNum-1)+"Id"+"Sudoku";
                iframe.width = "1438px";
                iframe.height = "650px";
                createOnClickButton(1400, y+34, 40, 20, "x", ()=>{
                    ctx.font = "80px Roboto";
                    ctx.fillText(language=="English"?"Games":"விளையாட்டு", x, y+100);
                    ctx.font = "20px Arial";
                    iframe.remove();
                });
                document.getElementById((winNum-1)+"Div").appendChild(iframe);
            });
        }else if(win.name == "Login"){
            ctx.fillText("Login", x, y+100);
            // Create Select
            select = CreateDropDown(x+20, y+150)
            select.innerHTML = "<option value=0 selected>"+(language=="English"?"None":"இல்லை")+"</option><option value=1>"+(language=="English"?"TVA":"டிவிஏ")+"</option><option value=2>"+(language=="English"?"Epic Sites":"அருமையான விளையாட்டுகள்")+"</option>";
            document.getElementById((winNum==0?0:winNum-1)+"ImportantDiv").appendChild(select);
            select.addEventListener("change", (event)=>{
                document.getElementById((winNum==0?0:winNum-1) + "Div").innerHTML = "";
                select.children[0].remove();
                if (select.value == 1){
                    LoginApp(x, y, "TVA");
                }else if (select.value == 2){
                    LoginApp(x, y, "EpicGames");
                };
                // addInput(x+50, y+200);
            });
            // Add input
        }else if(win.name == "Settings"){
            ctx.font = "30px Helvetica";
            ctx.fillStyle = "grey";
            ctx.fillRect(x+1, y+30, 300, 670);
            ctx.fillStyle = "black";
            ctx.fillStyle = "black";
            ctx.fillRect(x+50, y+100, 100, 40);
            ctx.font = "25px Helvetica";
            ctx.fillText(language=='English'?"Lockscreen: ":"பூட்டுத்திரை: ", x+301, y+100);
            list = [["Personalization", "தனிப்படுத்தல்"], ["Language", "மொழி"], ["Settings", "அமைப்புகள்"], ["About", "பற்றி"]];
                createOnClickButton(x+450, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "black";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "black");
                createOnClickButton(x+490, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "green";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "green");
                createOnClickButton(x+530, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "red";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "red");
                createOnClickButton(x+570, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "blue";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "blue");
                createOnClickButton(x+610, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "white";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "white");
                    ctx.drawImage(document.getElementById("L5"), x+700, y+50, 100, 78);
                createClick(x+700, y+50, 100, 78, ()=>{
                    lockscreen.type="picture";lockscreen.color = "5";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                });
                ctx.fillStyle = "black";  
                ctx.fillRect(x+610, y+70, 40, 40);
                ctx.clearRect(x+613, y+71, 36, 38); 
            createOnClickButton(x+1, y+100, 300, 40, language=='English'?list[0][0]:list[0][1], (ev)=>{
                document.getElementById((winNum==0?0:winNum-1)+"ImportantDiv").innerHTML = "";
                createButton(x+1, y+200, 300, 40, language=='English'?list[1][0]:list[1][1], "gray");
                createButton(x+1, y+150, 300, 40, language=='English'?list[2][0]:list[2][1], "gray");
                createButton(x+1, y+250, 300, 40, language=='English'?list[3][0]:list[3][1], "gray");
                createOnClickButton(x+1, y+100, 300, 40, language=='English'?list[0][0]:list[0][1], (ev)=>{
                }, "#b0b0b0");
                ctx.clearRect(x+301, y+70, 1000, 600);
                ctx.font = "25px Helvetica";
                ctx.fillText(language=='English'?"Lockscreen: ":"பூட்டுத்திரை: ", x+301, y+100);
                createOnClickButton(x+450, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "black";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "black");
                createOnClickButton(x+490, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "green";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "green");
                createOnClickButton(x+530, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "red";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "red");
                createOnClickButton(x+570, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "blue";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "blue");
                createOnClickButton(x+610, y+70, 40, 40, "     ", ()=>{
                    lockscreen.type="color";lockscreen.color = "white";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                }, "white");
                    ctx.drawImage(document.getElementById("L5"), x+700, y+50, 100, 78);
                createClick(x+700, y+50, 100, 78, ()=>{
                    lockscreen.type="picture";lockscreen.color = "5";
                    localStorage.lockscreen = JSON.stringify(lockscreen);
                });
                ctx.fillStyle = "black";  
                ctx.fillRect(x+610, y+70, 40, 40);
                ctx.clearRect(x+613, y+71, 36, 38);  
            }, "#b0b0b0");
            createOnClickButton(x+1, y+200, 300, 40, language=='English'?list[1][0]:list[1][1], (ev)=>{
                LanguageChoose(x, y);
            });
            createOnClickButton(x+1, y+150, 300, 40, language=='English'?list[2][0]:list[2][1], (ev)=>{
                document.getElementById((winNum==0?0:winNum-1)+"Div").innerHTML = "";
                document.getElementById((winNum==0?0:winNum-1)+"ImportantDiv").innerHTML = "";
                createOnClickButton(x+1, y+100, 300, 40, language=='English'?list[0][0]:list[0][1], (ev)=>{
                }, "gray");;
                createButton(x+1, y+150, 300, 40, language=='English'?list[2][0]:list[2][1], "#b0b0b0");
                createButton(x+1, y+200, 300, 40, language=='English'?list[1][0]:list[1][1], "gray");
                createButton(x+1, y+250, 300, 40, language=='English'?list[3][0]:list[3][1], "gray");
                ctx.clearRect(x+301, y+50, 900, 600);
                createOnClickButton(x+400, y+200, 300, 40, language=="English"?"Reset":"மீட்டமை", (ev)=>{
                    if (confirm(language=="English"?"Are you sure? This will reset your entire OS.":"உங்களுக்கு அது நல்லா தெரியுமா? இது உங்கள் முழு கணினியையும் மீட்டமைக்கும்.")) {
                        createOnClickButton(x+1000, y+250, 400, 40, language=="English"?"Are you really sure?":"அது உங்களுக்கு நன்றாகத் தெரியுமா?", (ev)=>{
                            localStorage.clear();
                            window.location.reload();
                        }, "green");
                    }
                });
            });
            createOnClickButton(x+1, y+250, 300, 40, language=='English'?list[3][0]:list[3][1], (ev)=>{
                document.getElementById((winNum==0?0:winNum-1)+"Div").innerHTML = "";
                document.getElementById((winNum==0?0:winNum-1)+"ImportantDiv").innerHTML = "";
                createOnClickButton(x+1, y+100, 300, 40, language=='English'?list[0][0]:list[0][1], (ev)=>{
                }, "gray");;
                createButton(x+1, y+150, 300, 40, language=='English'?list[2][0]:list[2][1], "gray");
                createButton(x+1, y+200, 300, 40, language=='English'?list[1][0]:list[1][1], "gray");
                createButton(x+1, y+250, 300, 40, language=='English'?list[3][0]:list[3][1], "#b0b0b0");
                ctx.clearRect(301, 70, 900, 300);
                ctx.fillText("ⓘ VishnuOS Computer", x+310, y+100);
                ctx.fillText("© Epic Sites Inc.", x+310, y+130);
                ctx.fillText("By: Vishnu Ramesh and Joey Matteucci", x+310, y+150);
                ctx.fillText("Partially allied with TVA (Timeless Vision Association) Inc. (Contract was not yet created)", x+310, y+170);
                ctx.fillText("All Rights Reserved", x+310, y+200);
                ctx.fillText("Running on " + getOSDetails(), x+310, y+500);
            });
        };
    };
    function MoveLeft(layer){
        winNum--;
        if (document.getElementById((winNum==0?0:winNum-1) + "Div") && document.getElementById((winNum==0?0:winNum-1) + "ImportantDiv")) {
        document.getElementById((winNum==0?0:winNum-1) + "Div").removeAttribute("hidden");
        document.getElementById((winNum==0?0:winNum-1) + "ImportantDiv").removeAttribute("hidden");
        }
        if (layer == -1 && layer < windows.length){
            if (windows.length != 1) {
                layer = windows.length-1;
            }else{
                layer = 1;
            }
        };
        windows[layer].ImageData = ctx.getImageData(0, 40, 1400, 700);
        console.log(windows[layer-1].ImageData, windows[layer].ImageData);
        if(layer > 0){
            ctx.putImageData(windows[layer-1].ImageData, 0, 40);
        }
        if (layer-1 != -1) {
        layer--;
        }

        clickableElements.splice(2);
        x = 0, y=40, width=1450, height=710;
                win = windows[layer];
                createClick(x+width-90, y, 10, 30, ()=>{
                    if (layer == 0){
                        layer = MoveRight(win.layer);
                    }else {
                        layer = MoveLeft(win.layer);
                    };
                });
                createClick(x+width-30, y, 10, 30, ()=>{
                    CloseWindow(win, x, y, width, height);
                });
                createClick(x+width-60, y, 10, 30, ()=>{
                    console.log("BOX");
                });
        return layer;
    };
    function MoveRight(layer){
        if (layer != -1 && layer < windows.length){
            console.log(winNum);
            console.log(document.getElementById((winNum==0?0:winNum-1) + "ImportantDiv"));
            document.getElementById((winNum==0?0:winNum-1) + "Div").hidden = "true";
            document.getElementById((winNum==0?0:winNum-1) + "ImportantDiv").hidden = "true";
            if (document.getElementById((winNum) + "Div")) {
            document.getElementById((winNum) + "Div").removeAttribute("hidden");
            document.getElementById((winNum) + "ImportantDiv").removeAttribute("hidden");
            }
            winNum++;
            windows[layer].ImageData = ctx.getImageData(0, 40, 1400, 700);
            if (layer + 1 != windows.length) {
                ctx.putImageData(windows[layer+1].ImageData, 0, 40);
                layer++;
                clickableElements.splice(2);
                win = windows[layer];
                x = 0, y=40, width=1400, height=700;
                createClick(x+width-90, y, 10, 30, ()=>{
                    if (layer == 0){
                        layer = MoveRight(win.layer);
                    }else {
                        layer = MoveLeft(win.layer);
                    };
                });
                createClick(x+width-30, y, 10, 30, ()=>{
                    CloseWindow(win, x, y, width, height);
                });
                createClick(x+width-60, y, 10, 30, ()=>{
                    console.log("BOX");
                });
            }
        }
        return layer;
    };
    function CloseWindow(win, x, y, width, height){
        // win.ImageData = ctx.getImageData(x, y, width, height);
        if (document.getElementById((winNum==0?0:winNum-1) + "Div")) {
            document.getElementById((winNum==0?0:winNum-1) + "Div").remove();
            document.getElementById((winNum==0?0:winNum-1)+"ImportantDiv").remove();
            ;
        };
        win.title = "";
        winNum--;
        ctx.clearRect(x, y, width, height);
        if (lockscreen.type == "color") {
            ctx.fillStyle = lockscreen.color;
            ctx.fillRect(0, 40, 1450, 710);
        }else if (lockscreen.type == "picture"){
                ctx.drawImage(document.getElementById("L"+lockscreen.color), 0, 40, 1450, 710);
        }
        for (let i = windows.length - 1; i >= 0; i--) {
            if (windows[i] == win) {
                windows.splice(i, 1); // Remove element at index i
                // break;
            }
        }
        // windows = windows.filter(item => item.name !== "HIII")
        // ctx.clearRect(windows.length * 100, 30, ctx.measureText(winname).width(), 30);
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, 1700, 40);
        ctx.fillStyle = "white";
        var idx = 0
            ctx.font = "20px Arial";
        windows.forEach((el) => {
            ctx.fillText(String(el.winname), idx * 100, 30);
            idx = idx + 1
        });
    };
    function Window1(x, y, width, height, title, win){
        if (document.getElementById((winNum==0?0:winNum-1) + "Div") && document.getElementById((winNum==0?0:winNum-1) + "ImportantDiv")) {
            document.getElementById((winNum==0?0:winNum-1) + "Div").hidden = "true";
            document.getElementById((winNum==0?0:winNum-1) + "ImportantDiv").hidden = "true";
        }
        winNum++;
        clickableElements = JSON.parse("[{\"x\":0,\"y\":740,\"width\":110,\"height\":50,\"code\":0},{\"x\":160,\"y\":743,\"width\":48,\"height\":48,\"code\":1},{\"x\":220,\"y\":747,\"width\":40,\"height\":40,\"code\":2},{\"x\":270,\"y\":750,\"width\":36,\"height\":36,\"code\":3}]");
        clickableElements[0].functionOnClicked = (event) => {
            console.log("Opening the time");
        };
        clickableElements[1].functionOnClicked = (event) => {
            Game("RedGame");
        };
        clickableElements[2].functionOnClicked = (event) => {
            Game("Login");
        };
        clickableElements[3].functionOnClicked = (event) => {
            Game("Settings");
        };
        if (!document.getElementById(win.id+"Div")) {
            span = document.createElement("span");
            span.id = win.id+"Div";
            document.getElementById("List").appendChild(span);
            span = document.createElement("span");
            span.id = win.id+"ImportantDiv";
            document.getElementById("ImportantList").appendChild(span);
        }
        ctx.clearRect(0, 40, 1450, 710);
        Setup(x, y, width, height, title, win);
        win.ImageData = ctx.getImageData(x, y, width, height);
        ctx.rect(x, y, width, height);
        ctx.stroke();
        ctx.rect(x, y, width, 30);
        ctx.stroke();
            ctx.font = "20px Arial";
        ctx.fillText(title, x+10, y+25);
        ctx.fillStyle = "black";
        ctx.fillText("-", x+width-90, y+25);
        ctx.fillText("x", x+width-30, y+25);
        ctx.fillText("■", x+width-60, y+25);
        win.ImageData = ctx.getImageData(x, y, width, height);
        createClick(x+width-90, y, 10, 30, ()=>{
            if (layer == 0){
                layer = MoveRight(win.layer);
            }else {
                layer = MoveLeft(win.layer);
            };
        });
        createClick(x+width-30, y, 10, 30, ()=>{
            CloseWindow(win, x, y, width, height);
        });
        createClick(x+width-60, y, 10, 30, ()=>{
            console.log("BOX");
        });
    };
    function Game(name){
        winname = windows.length;
        ctx.clearRect(0, 40, 1450, 710);
        ctx.fillStyle = "white";
        ctx.font = "20px Arial";
        ctx.fillText(winname, windows.length * 100, 30);
        win = {name:name, layer:windows.length, id:windows.length, winname:winname};
        windows.push(win);
        ctx.fillStyle = "black";
        Window1(0, 40, 1450, 710, winname, win);
    };
    setInterval(()=>{
        const now = new Date(); // Get the current date and time
        let hours = now.getHours(); // Get the current hour (0-23)
        let minutes = now.getMinutes(); // Get the current minutes (0-59)
        minutes = minutes < 10 ? '0' + minutes : minutes;
        fill = ctx.fillStyle;
        ctx.fillStyle = "grey";
        ctx.fillRect(100, 750, 60, 60);
        console.log(ctx.font);
        ctx.font = "20px Arial";
        ctx.fillStyle = "black";
        ctx.fillText(hours+":"+minutes, 100, 780);
        ctx.fillStyle = fill;
        console.log("HI");
    }, 60000);
    if (!localStorage.OSBooted) {
        localStorage.OSBooted = true;
        ctx.rect(10,15,300,200);
        ctx.stroke();
        ctx.fillText("Welcome To", 80, 50);
        ctx.font = "50px Arial";
        ctx.fillText("VishnuOS", 50, 100);
        drop = CreateDropDown(500, 100);
        drop.innerHTML = "<option value=1 selected>English</option><option value=2>தமிழ்</option>";
        drop.id = "SpecialDrop";
        drop.addEventListener("change", ()=>{
            if (drop.value == 2){
                window.location.reload();
                localStorage.language = "Tamil";
            };
        });
        document.body.appendChild(drop);
        createOnClickButton(105, 150, 100, 40, "Tutorial", (click) => {
            ctx.clearRect(0, 0, 1000, 1000);
            ctx.fillText("No thank you. Just go back. At least you learned that Ctrl-Y opens the view to see your windows! Also Esc brings you to the page mode where you can choose", 40, 50, 2000);
            ctx.fillText("your page and can go back by pressing p.", 40, 80, 2000);
            createOnClickButton(80, 100, 100, 40, "Go Back", (click) => {
                localStorage.OSBooted = false;
                window.location.reload();
            });
        });
    }else {
        var _ImageData;
        var mode = 0;
        var layer = -1;
        ctx.fillRect(0, 0, 1700, 40);
        document.onkeydown = (e) => {
            if (e.key == 123) {
                e.preventDefault();
            }
            if (e.ctrlKey && e.shiftKey && e.key == 'I') {
                e.preventDefault();
            }
            if (e.ctrlKey && e.shiftKey && e.key == 'C') {
                e.preventDefault();
            }
            if (e.ctrlKey && e.shiftKey && e.key == 'J') {
                e.preventDefault();
            }
            if (e.ctrlKey && e.key == 'U') {
                e.preventDefault();
            }
        };

        window.addEventListener("keydown", (event)=>{
            if(event.keyCode == 89 && event.ctrlKey){
                if (_ImageData) {
                    ctx.putImageData(_ImageData, 0, 0);
                    for (i=0; i<=inputNum-1; i++){
                        console.log(document.getElementById(i+"Id"));
                        document.getElementById(i+"Id").removeAttribute("hidden");
                    };
                    _ImageData = 0;
                }else {
                    _ImageData = ctx.getImageData(0, 0, 1700, 930);
                    ctx.clearRect(0, 0, 1700, 930);
                    for (i=0; i<=inputNum-1; i++){
                        console.log(document.getElementById(i+"Id"));
                        document.getElementById(i+"Id").hidden = "true";
                    };
                    var x = 50, y = 50;
                    windows.forEach((item) => {
                        ctx.rect(x, y, 100, 100);
                        ctx.fillText(item.name, x+5, y + 25);
                        ctx.stroke();
                        x += 100;
                    });
                }
            }else if(event.keyCode==27){
                mode = 1;
            }else if(event.keyCode==80 && mode == 1){
                mode = 0;
            }else if(event.keyCode == 39 && mode == 1){ // Right
                layer = MoveRight(layer);
            }else if(event.keyCode == 37 && mode == 1){ // Left
                layer = MoveLeft(layer);
            }else if(event.ctrlKey && event.key === 'w'){
                ev.preventDefault();
                alert("HII");
            }else{
                console.log(event.keyCode);
            };
        });
        LockScreen();
        ctx.fillStyle = "grey";
        ctx.fillRect(0, 750, 1450, 60);
        const d = new Date();
        const year = 1000 * 60 * 60 * 24 * 365;
        let years = Math.round(d.getTime() / year);
        ctx.font = "20px Arial";
        ctx.fillStyle = "black";
        date = (d.getMonth() + 1) + "/" + (d.getDate()) + "/"+String(years + 1969).substring(2);
        ctx.fillText(date, 10, 780);
        createClick(0, 740, 110, 50, (event) => {
            console.log("Opening the time");
        });

        const now = new Date(); // Get the current date and time
        let hours = now.getHours(); // Get the current hour (0-23)
        let minutes = now.getMinutes(); // Get the current minutes (0-59)
        minutes = minutes < 10 ? '0' + minutes : minutes;
        ctx.font = "20px Arial";
        ctx.fillStyle = "black";
        ctx.fillText(hours+":"+minutes, 100, 780);

        document.getElementById("star").addEventListener("load", (e) => {
            ctx.drawImage(document.getElementById("star"), 160, 743, 48, 48);
            createClick(160, 743, 48, 48, ()=>{
                Game("RedGame");
            });
        })

        document.getElementById("login").addEventListener("load", (e) => {
            ctx.drawImage(document.getElementById("login"), 220, 747, 40, 40);
            createClick(220, 747, 40, 40, ()=>{
                Game("Login");
            });
        })

        document.getElementById("settings").addEventListener("load", (e) => {
            ctx.drawImage(document.getElementById("settings"), 270, 750, 36, 36);
            createClick(270, 750, 36, 36, ()=>{
                Game("Settings");
            });
        })
    }
</script>

</body>
</html>

